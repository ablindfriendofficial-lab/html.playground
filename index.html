<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strict Project Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="style.css"> 
</head>
<body>
    
    <!-- Loading Screen -->
    <div id="view-loading" class="view-section active center-screen" style="z-index: 100; background: var(--bg-main);">
        <div style="font-size: 1.5rem; color: var(--accent);">
            <span id="loading-spinner">...</span> Initializing App
        </div>
    </div>
    
    <!-- Auth Screen -->
    <div id="view-auth" class="view-section center-screen">
        <div class="action-box" id="auth-box">
            <span class="icon-large">üîë</span>
            <h2 id="auth-title">Log In</h2>
            <input type="email" id="auth-email" placeholder="Email" style="width: 100%; padding: 10px; margin-bottom: 10px;">
            <input type="password" id="auth-password" placeholder="Password" style="width: 100%; padding: 10px; margin-bottom: 15px;">
            <div id="auth-message" style="color: var(--error); display: none; margin-bottom: 10px;"></div>
            <button class="btn-base btn-primary" id="login-btn" style="width: 100%;" onclick="handleAuthAction()">Log In</button>
            <button class="btn-base btn-secondary" id="signup-btn" style="width: 100%; display: none;" onclick="handleAuthAction()">Sign Up</button>
            <button class="btn-base" style="margin-top: 20px; background: none; color: var(--text-dim); text-decoration: underline;" onclick="toggleAuthMode()">Switch to <span id="mode-toggle-text">Sign Up</span></button>
        </div>
    </div>

    <!-- Upload Screen (Buttons Fixed Here) -->
    <div id="view-upload" class="view-section center-screen">
        <header class="toolbar">
            <div class="toolbar-group"><span>Welcome!</span></div>
            <div class="toolbar-group"><button class="btn-base btn-danger" onclick="userSignOut()">Log Out</button></div>
        </header>

        <div class="action-box" id="drop-zone">
            <span class="icon-large">üìÇ</span>
            <h2>Upload New Project</h2>
            
            <div style="display: flex; flex-direction: column; gap: 10px; width: 100%;">
                <label for="file-input" class="btn-base btn-primary" style="justify-content: center;">+ Add Files</label>
                <label for="folder-input" class="btn-base btn-secondary" style="justify-content: center;">+ Add Folder</label>
            </div>

            <ul id="mini-file-list" style="text-align: left; width: 100%; margin-top: 10px; list-style: none; padding: 0;"></ul>
            <div id="file-count" style="color: var(--text-dim); font-size: 0.8rem;"></div>

            <!-- Warning Box (Will be hidden by JS now) -->
            <div id="error-display" style="margin-top: 10px; color: var(--warning);">
                <strong>‚ö†Ô∏è Still Missing:</strong>
                <ul id="missing-list" style="padding-left: 20px;"></ul>
            </div>
            
            <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 20px; width: 100%;">
                
                <!-- PREVIEW & SAVE BUTTONS (Make sure these are here!) -->
                <button id="open-editor-btn" class="btn-base btn-primary" disabled onclick="openEditor(null)">
                    üëÅÔ∏è Preview / Edit Code
                </button>
                
                <button id="save-project-btn" class="btn-base btn-success" disabled onclick="saveProject()">
                    üíæ Save to Supabase
                </button>

                <div style="display: flex; gap: 10px; width: 100%; margin-top: 10px;">
                    <button class="btn-base btn-secondary" onclick="switchView('view-projects')" style="flex: 1;">See Saved</button>
                    <button class="btn-base btn-danger" onclick="resetUploadState()" style="flex: 1;">Clear</button>
                </div>
            </div>

            <input type="file" id="file-input" multiple style="display: none;">
            <input type="file" id="folder-input" webkitdirectory directory multiple style="display: none;">
        </div>
    </div>

    <!-- Other Views (Projects, Workspace, etc.) -->
    <div id="view-projects" class="view-section">
        <header class="toolbar">
            <button class="btn-base btn-secondary" onclick="switchView('view-upload')">‚Üê Back</button>
            <span>My Projects</span>
        </header>
        <div class="workspace-body center-screen"><div id="projects-list"></div></div>
    </div>

    <div id="view-workspace" class="view-section">
        <header class="toolbar">
            <button class="btn-base btn-secondary" onclick="switchView('view-upload')">‚Üê Back</button>
            <span>Preview</span>
            <button class="btn-base btn-primary" onclick="refreshPreview()">Reload</button>
        </header>
        <div class="workspace-body"><iframe id="preview-frame" style="width:100%; height:100%; border:none;"></iframe></div>
    </div>

    <div id="save-modal-overlay" class="view-section center-screen" style="z-index: 1000; background: rgba(0,0,0,0.8); display: none;">
        <div class="action-box">
            <h3>Name Project</h3>
            <input type="text" id="project-name-input" style="width: 100%; padding: 10px; margin: 10px 0;">
            <div style="display: flex; gap: 10px;">
                <button class="btn-base btn-secondary" onclick="cancelSave()">Cancel</button>
                <button class="btn-base btn-success" onclick="confirmSaveProject()">Save</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script> 
</body>
</html>


